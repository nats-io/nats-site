{{ $desc      := site.Params.description_long | markdownify }}
{{ $companies := site.Data.companies.companies }}

<section class="section has-background-white">
  <div class="columns is-centered">
    <div class="column has-text-centered">

        <h2 class="title is-spaced is-size-3 is-size-4-mobile has-text-dark has-text-weight-light">Powering Industry Leaders</h2>

        <!-- Industry filter tabs -->
        <div class="industry-filters" style="display: flex; justify-content: center; gap: 1.5rem; margin-top: 1rem;">
          <button class="industry-tab" data-industry="automotive" style="background: transparent; border: none; color: #27aae1; cursor: pointer; font-weight: bold; font-size: 1rem; padding: 0.5rem;">Automotive & Industrial</button>
          <button class="industry-tab" data-industry="financial" style="background: transparent; border: none; color: #a3d4f0; cursor: pointer; font-weight: bold; font-size: 1rem; padding: 0.5rem;">Financial Services</button>
          <button class="industry-tab" data-industry="telecom" style="background: transparent; border: none; color: #a3d4f0; cursor: pointer; font-weight: bold; font-size: 1rem; padding: 0.5rem;">Telecom & Media</button>
          <button class="industry-tab" data-industry="tech" style="background: transparent; border: none; color: #a3d4f0; cursor: pointer; font-weight: bold; font-size: 1rem; padding: 0.5rem;">Tech & Cloud</button>
          <button class="industry-tab" data-industry="retail" style="background: transparent; border: none; color: #a3d4f0; cursor: pointer; font-weight: bold; font-size: 1rem; padding: 0.5rem;">Retail & Consumer</button>
        </div>

    </div>
  </div>
  <div class="container">
    <div class="columns is-vcentered is-multiline" id="companies-grid">

          {{ $.Scratch.Set "counter" 0 }}
          {{ range sort $companies "rank" }}
          {{ $img := printf "img/logos/companies/%s" .logo | relURL }}
          {{ $counter := $.Scratch.Get "counter" }}
          {{ $isHidden := ge $counter 25 }}
          {{ $industry := .industry | default "tech" }}
          <div class="column
          is-half-mobile
          is-one-third-tablet
          is-one-quarter-desktop
          is-one-fifth-widescreen
          logo company-logo{{ if $isHidden }} hidden-logo{{ end }}" data-industry="{{ $industry }}" {{ if $isHidden }}style="display: none;"{{ end }}>
<a href="{{ .home }}" target="_blank">
  <img class="is-user-logo" src="{{ $img }}" alt="{{ .name }} logo">
</a>
</div>
          {{ $.Scratch.Add "counter" 1 }}
          {{ end }}
    </div>
    <div class="columns is-centered" style="margin-top: 2rem;">
      <div class="column has-text-centered is-narrow">
        <button id="toggle-logos-btn" class="button is-normal is-link has-text-weight-bold" onclick="toggleLogos()" style="margin-right: 1rem;">
          Show All Companies
        </button>
        <a class="button is-normal is-primary has-text-weight-bold" href="https://github.com/nats-io/nats-site#adding-a-company-logo" target="_blank">
          Add Your Company
        </a>
      </div>
    </div>
  </div>
  </div>
</section>

<script>
function toggleLogos() {
  const hiddenLogos = document.querySelectorAll('.hidden-logo');
  const button = document.getElementById('toggle-logos-btn');
  const isExpanded = button.getAttribute('data-expanded') === 'true';

  hiddenLogos.forEach(logo => {
    if (isExpanded) {
      logo.style.display = 'none';
    } else {
      logo.style.display = '';
    }
  });

  if (isExpanded) {
    button.textContent = 'Show All Companies';
    button.setAttribute('data-expanded', 'false');
  } else {
    button.textContent = 'Show Less';
    button.setAttribute('data-expanded', 'true');
  }
}

// Industry filter functionality
document.addEventListener('DOMContentLoaded', function() {
  const tabs = document.querySelectorAll('.industry-tab');
  const logos = document.querySelectorAll('.company-logo');

  function filterByIndustry(industry) {
    // Update tab styles
    tabs.forEach(t => {
      t.style.color = t.getAttribute('data-industry') === industry ? '#27aae1' : '#a3d4f0';
    });

    // Filter logos
    logos.forEach(logo => {
      if (logo.getAttribute('data-industry') === industry) {
        logo.style.display = '';
      } else {
        logo.style.display = 'none';
      }
    });
  }

  // Filter on page load (default to automotive)
  filterByIndustry('automotive');

  tabs.forEach(tab => {
    tab.addEventListener('click', function() {
      const industry = this.getAttribute('data-industry');
      filterByIndustry(industry);
    });
  });
});
</script>

